# Simple Upload System - 간소화된 업로드 시스템

## 개요

Supabase 연동 없이 동영상 URL을 입력받아 TeraBox에 업로드하는 간소화된 시스템입니다.

## 주요 특징

### 1. 단순 등록 프로세스

- URL만 입력하면 즉시 응답
- Supabase 등록/수정 없음
- 백그라운드에서 자동 처리

### 2. 순차적 작업 처리

- **대기중**: 무제한 (큐에 쌓임)
- **다운로드중**: 최대 1개만 처리
- **압축중**: 최대 1개만 처리
- **업로드중**: 최대 1개만 처리

### 3. 실시간 진행 상황 로그

```
================================================================================
📊 [Queue Status]
================================================================================
⏳ 대기중: 5
⬇️  다운로드중: 1 (245.3MB / 512.0MB, 48%)
🔄 압축중: 0
⬆️  업로드중: 0
✅ 완료: 12
❌ 실패: 0
================================================================================
```

## 파일 구조

```
app/
├── add/
│   └── page.js                    # 등록 화면 (URL 입력)
├── api/
│   ├── simple-upload/
│   │   └── route.ts              # 간소화된 업로드 API
│   └── upload/
│       └── route.ts              # 기존 업로드 API (Supabase 연동)
lib/
├── simpleJobQueue.ts             # 새로운 간소화된 작업 큐
└── jobQueue.ts                   # 기존 작업 큐 (Supabase 연동)
```

## API 엔드포인트

### POST /api/simple-upload

동영상 URL을 받아 업로드 작업을 큐에 등록합니다.

**Request:**

```json
{
  "url": "https://example.com/video.mp4"
}
```

**Response (즉시 반환):**

```json
{
  "success": true,
  "message": "업로드 중입니다...",
  "jobId": "sjob_1234567890_abc123"
}
```

### GET /api/simple-upload

현재 큐 상태를 조회합니다.

**Response:**

```json
{
  "queued": 5,
  "downloading": {
    "id": "sjob_xxx",
    "status": "downloading",
    "progress": {
      "percentage": 48,
      "sizeMB": 245.3,
      "totalMB": 512.0,
      "message": "다운로드: 48.0%"
    }
  },
  "compressing": null,
  "uploading": null,
  "done": 12,
  "error": 0,
  "total": 18
}
```

## 작업 처리 흐름

```
1. 사용자가 URL 입력
   ↓
2. /api/simple-upload POST 호출
   ↓
3. 즉시 응답: "업로드 중입니다..."
   ↓
4. 사용자는 메인 화면으로 이동
   ↓
5. 백그라운드 처리 시작
   ├─ 대기중 (큐)
   ├─ 다운로드 (1개씩)
   ├─ 압축 (1개씩)
   └─ 업로드 (1개씩)
   ↓
6. 완료: TeraBox File ID 생성
   (예: terabox://123456789)
```

## 사용 방법

### 1. 등록 화면 접속

- 메인 화면 우측 상단 `+` 버튼 클릭
- `/add` 페이지로 이동

### 2. URL 입력

- 동영상 URL 입력 (예: `https://example.com/video.mp4`)
- "등록" 버튼 클릭

### 3. 자동 처리

- 즉시 메인 화면으로 이동
- 백그라운드에서 자동으로 다운로드, 압축, 업로드 진행

### 4. 서버 로그 확인

터미널에서 실시간 진행 상황 확인 가능:

```bash
npm run dev

# 로그 예시:
⬇️  다운로드중: 1 (245.3MB / 512.0MB, 48%)
🔄 압축중: 1 (32.1MB, 12%)
⬆️  업로드중: 1 (32.1MB, 44%)
```

## 기존 시스템과의 차이점

| 항목          | 기존 (/api/upload) | 새로운 (/api/simple-upload) |
| ------------- | ------------------ | --------------------------- |
| Supabase 연동 | ✅ 필요            | ❌ 불필요                   |
| ID 필요       | ✅ Supabase ID     | ❌ 자동 생성                |
| 동시 처리     | 10개               | 1개 (순차)                  |
| DB 업데이트   | ✅ URL 저장        | ❌ 없음                     |
| [upload] 태그 | ✅ 사용            | ❌ 사용 안함                |
| 결과          | Supabase 업데이트  | 로그만 출력                 |

## 향후 개선 사항

- [ ] 완료된 파일 ID 목록 UI 제공
- [ ] 실패한 작업 재시도 기능
- [ ] 작업 취소 기능
- [ ] 웹소켓으로 실시간 진행률 표시
- [ ] 완료된 파일 자동 재생 목록 추가

## 주의사항

- 현재는 TeraBox File ID가 생성되지만 별도로 저장되지 않습니다
- 서버 재시작 시 진행 중인 작업은 초기화됩니다
- 완료된 파일은 서버 로그에서만 확인 가능합니다
